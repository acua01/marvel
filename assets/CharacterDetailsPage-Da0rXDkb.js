import{j as r,r as o,u as m,L as f}from"./index-BDqQPv4M.js";import{u as x,F as p}from"./useScrollUp-BVybyDpB.js";import{u as h,a as j,b as C,A as L}from"./characters.adapter-ZCZdniyF.js";import{E as b}from"./ErrorMessage-D6aapZE7.js";const y=({title:e,image:a,year:s})=>r.jsxs("article",{className:"c-comic","aria-labelledby":e,children:[r.jsx("figure",{className:"c-comic__image-container",children:r.jsx("img",{src:a??"image_not_found.svg",alt:e,title:e})}),r.jsx("p",{className:"c-comic__title",id:e,children:e}),r.jsx("p",{className:"c-comic__year",children:s})]}),D=()=>{const e=o.useRef(null),a=o.useRef(!1),s=o.useRef(0),t=o.useRef(0),c=o.useRef(null),n=d=>{e.current&&(a.current=!0,s.current=d.pageX,t.current=e.current.scrollLeft,e.current.classList.add("grabbing"))},l=o.useCallback(d=>{if(!a.current||!e.current)return;d.preventDefault();const g=(d.pageX-s.current)*1;e.current.scrollLeft=t.current-g},[]),i=()=>{a.current=!1,e.current&&e.current.classList.remove("grabbing")},u=()=>{a.current=!1,e.current&&e.current.classList.remove("grabbing")},_=()=>{e.current&&c.current!==null&&(e.current.scrollLeft=t.current,c.current=null)};return{containerRef:e,handleMouseDown:n,handleMouseMove:l,handleMouseUp:i,handleMouseLeave:u,handleScroll:()=>{!a.current&&e.current&&(t.current=e.current.scrollLeft,c.current===null&&(c.current=requestAnimationFrame(_)))}}},v=({comics:e})=>{const{containerRef:a,handleMouseDown:s,handleMouseLeave:t,handleMouseMove:c,handleMouseUp:n,handleScroll:l}=D();return r.jsxs("section",{className:"c-comics-slider","aria-labelledby":"comics-slider-heading",children:[r.jsx("h2",{className:"c-comics-slider__title",id:"comics-slider-heading",children:"Comics"}),r.jsx("div",{className:"c-comics-slider__comics-container",ref:a,onMouseDown:s,onMouseMove:c,onMouseUp:n,onMouseLeave:t,onScroll:l,role:"list",children:e.length>0?r.jsx(r.Fragment,{children:e.map(i=>r.jsx(y,{title:i.title,year:i.date.getFullYear(),image:i.image},i.title))}):r.jsx("p",{children:"Comics not found"})})]})},N=()=>{const{characterId:e}=m(),{data:a,isLoading:s,isFetching:t,error:c}=h({queryKey:["get-character-details"],queryFn:()=>j(e||"")});return{data:a,isLoading:s,isFetching:t,error:c}},M=async e=>{const s=(await C.get(`/v1/public/characters/${e}/comics?${L}`)).data.data.results.map(t=>{var c;return{title:t.title,image:`${t.thumbnail.path}.${t.thumbnail.extension}`,date:new Date(((c=t.dates.find(n=>n.type==="onsaleDate"))==null?void 0:c.date)||"")}});return s.sort((t,c)=>t.date.getTime()+c.date.getTime()),s},F=()=>{const{characterId:e}=m(),{data:a,isLoading:s,isFetching:t,error:c}=h({queryKey:["get-character-comics"],queryFn:()=>M(e||"")});return{data:a,isLoading:s,isFetching:t,error:c}},R=()=>{x();const{data:e,isLoading:a,isFetching:s,error:t}=N(),{data:c,isLoading:n,isFetching:l,error:i}=F();return{character:e?{id:e.id,name:e.name,image:e.image}:null,details:e,comics:c||[],isLoading:a||n||s||l,errorDetails:t,errorComics:i}},P=()=>{const{character:e,details:a,comics:s,isLoading:t,errorComics:c,errorDetails:n}=R();return t?r.jsx(f,{}):c||n?r.jsx(b,{message:"An error has occurred getting character details"}):!e||!a||!s?null:r.jsxs("section",{className:"c-character-details",role:"main",children:[r.jsx("section",{className:"c-character-details__character","aria-labelledby":"character-details-heading",children:r.jsxs("div",{className:"c-character-details__character__content",children:[r.jsx("figure",{className:"c-character-details__character__content__image-container",children:r.jsx("img",{className:"c-character-details__character__content__image-container__image",src:a.image??"image_not_found.svg"})}),r.jsxs("article",{className:"c-character-details__character__content__info-container",children:[r.jsxs("div",{className:"c-character-details__character__content__info-container__title",children:[r.jsx("h1",{id:"character-details-heading",children:a.name}),r.jsx(p,{className:"c-character-details__character__content__info-container__title__fav-button",character:e})]}),r.jsx("p",{className:"c-character-details__character__content__info-container__description",children:a.description??"Description not found"})]})]})}),r.jsx(v,{comics:s})]})};export{P as default};
