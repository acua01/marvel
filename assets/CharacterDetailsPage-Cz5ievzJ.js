import{j as a,r as l,u,L as _}from"./index-nLTeD_n1.js";import{u as g,F as f}from"./useScrollUp-vpFoAUNa.js";import{u as h,a as x,b as p,A as j}from"./characters.adapter-DMMGpLLY.js";import{E as C}from"./ErrorMessage-BckJekJ_.js";const M=({title:e,image:r,year:s})=>a.jsxs("article",{className:"c-comic","aria-labelledby":e,children:[a.jsx("figure",{className:"c-comic__image-container",children:a.jsx("img",{src:r??"image_not_found.svg",alt:e,title:e})}),a.jsx("p",{className:"c-comic__title",id:e,children:e}),a.jsx("p",{className:"c-comic__year",children:s})]}),L=()=>{const e=l.useRef(null),r=l.useRef(!1),s=l.useRef(0),t=l.useRef(0);return{containerRef:e,handleMouseDown:o=>{e.current&&(r.current=!0,s.current=o.pageX-e.current.offsetLeft,t.current=e.current.scrollLeft)},handleMouseMove:o=>{if(!r.current||!e.current)return;o.preventDefault();const m=o.pageX-e.current.offsetLeft-s.current;e.current.scrollLeft=t.current-m},handleMouseUp:()=>{r.current=!1},handleMouseLeave:()=>{r.current=!1}}},D=({comics:e})=>{const{containerRef:r,handleMouseDown:s,handleMouseLeave:t,handleMouseMove:c,handleMouseUp:n}=L();return a.jsxs("section",{className:"c-comics-slider","aria-labelledby":"comics-slider-heading",children:[a.jsx("h2",{className:"c-comics-slider__title",id:"comics-slider-heading",children:"Comics"}),a.jsx("div",{className:"c-comics-slider__comics-container",ref:r,onMouseDown:s,onMouseMove:c,onMouseUp:n,onMouseLeave:t,role:"list",children:e.length>0?a.jsx(a.Fragment,{children:e.map(i=>a.jsx(M,{title:i.title,year:i.date.getFullYear(),image:i.image},i.title))}):a.jsx("p",{children:"Comics not found"})})]})},y=()=>{const{characterId:e}=u(),{data:r,isLoading:s,isFetching:t,error:c}=h({queryKey:["get-character-details"],queryFn:()=>x(e||"")});return{data:r,isLoading:s,isFetching:t,error:c}},v=async e=>{const s=(await p.get(`/v1/public/characters/${e}/comics?${j}`)).data.data.results.map(t=>{var c;return{title:t.title,image:`${t.thumbnail.path}.${t.thumbnail.extension}`,date:new Date(((c=t.dates.find(n=>n.type==="onsaleDate"))==null?void 0:c.date)||"")}});return s.sort((t,c)=>t.date.getTime()+c.date.getTime()),s},N=()=>{const{characterId:e}=u(),{data:r,isLoading:s,isFetching:t,error:c}=h({queryKey:["get-character-comics"],queryFn:()=>v(e||"")});return{data:r,isLoading:s,isFetching:t,error:c}},F=()=>{g();const{data:e,isLoading:r,isFetching:s,error:t}=y(),{data:c,isLoading:n,isFetching:i,error:d}=N();return{character:e?{id:e.id,name:e.name,image:e.image}:null,details:e,comics:c||[],isLoading:r||n||s||i,errorDetails:t,errorComics:d}},U=()=>{const{character:e,details:r,comics:s,isLoading:t,errorComics:c,errorDetails:n}=F();return console.log("errors",c,n),t?a.jsx(_,{}):c||n?a.jsx(C,{message:"An error has occurred getting character details"}):!e||!r||!s?null:a.jsxs("section",{className:"c-character-details",role:"main",children:[a.jsx("section",{className:"c-character-details__character","aria-labelledby":"character-details-heading",children:a.jsxs("div",{className:"c-character-details__character__content",children:[a.jsx("figure",{className:"c-character-details__character__content__image-container",children:a.jsx("img",{className:"c-character-details__character__content__image-container__image",src:r.image||"image_not_found.svg",alt:r.name,title:r.name})}),a.jsxs("article",{className:"c-character-details__character__content__info-container",children:[a.jsxs("div",{className:"c-character-details__character__content__info-container__title",children:[a.jsx("h1",{id:"character-details-heading",children:r.name}),a.jsx(f,{className:"c-character-details__character__content__info-container__title__fav-button",character:e})]}),a.jsx("p",{className:"c-character-details__character__content__info-container__description",children:r.description||"Description not found"})]})]})}),a.jsx(D,{comics:s})]})};export{U as default};
